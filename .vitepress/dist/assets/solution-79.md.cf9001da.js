import{o as n,c as s,b as a}from"./app.0aaa57e5.js";const t='{"title":"Power Mode","description":"","frontmatter":{},"headers":[{"level":3,"title":"index.ts:","slug":"index-ts"},{"level":3,"title":"power-mode.ts:","slug":"power-mode-ts"}],"relativePath":"solution-79.md","lastUpdated":1613522705297}',p={},o=a('<h1 id="power-mode"><a class="header-anchor" href="#power-mode" aria-hidden="true">#</a> Power Mode</h1><p><a href="https://github.com/capacitor-community/proposals/issues/79" target="_blank" rel="noopener noreferrer">https://github.com/capacitor-community/proposals/issues/79</a></p><h3 id="index-ts"><a class="header-anchor" href="#index-ts" aria-hidden="true">#</a> <code>index.ts</code>:</h3><div class="language-typescript"><pre><code><span class="token comment">// Power Mode</span>\n<span class="token keyword">import</span> <span class="token string">&#39;./power-mode&#39;</span><span class="token punctuation">;</span>\n</code></pre></div><h3 id="power-mode-ts"><a class="header-anchor" href="#power-mode-ts" aria-hidden="true">#</a> <code>power-mode.ts</code>:</h3><div class="language-typescript"><pre><code><span class="token keyword">let</span> isListening <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> listener<span class="token punctuation">;</span>\n<span class="token keyword">let</span> listenerCallback<span class="token punctuation">;</span>\n<span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token string">&quot;android.os.action.POWER_SAVE_MODE_CHANGED&quot;</span><span class="token punctuation">;</span>\n\nnative<span class="token punctuation">.</span><span class="token function-variable function">togglePowerModeListener</span> <span class="token operator">=</span> <span class="token punctuation">(</span>\n\tcallback<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>isEnabled<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>\n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n\tlistenerCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>\n\t<span class="token keyword">if</span> <span class="token punctuation">(</span>native<span class="token punctuation">.</span>android<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t\t<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isListening<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t\t\tnative<span class="token punctuation">.</span>androidCapacitorActivity<span class="token punctuation">.</span><span class="token function">registerBroadcastReceiver</span><span class="token punctuation">(</span>\n\t\t\t\taction<span class="token punctuation">,</span>\n\t\t\t\t<span class="token punctuation">(</span>context<span class="token punctuation">,</span> intent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n\t\t\t\t\t<span class="token keyword">const</span> manager<span class="token operator">:</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>PowerManager <span class="token operator">=</span>\n\t\t\t\t\t\tnative<span class="token punctuation">.</span>androidCapacitorActivity\n\t\t\t\t\t\t  <span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context<span class="token punctuation">.</span><span class="token constant">POWER_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\t\t\t\t<span class="token keyword">if</span> <span class="token punctuation">(</span>manager <span class="token operator">&amp;&amp;</span> listenerCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t\t\t\t\t\t<span class="token function">listenerCallback</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span><span class="token function">isPowerSaveMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\t\t\t\t<span class="token punctuation">}</span>\n\t\t\t\t<span class="token punctuation">}</span>\n\t\t\t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\t\tisListening <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n\t\t<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n\t\t\tnative<span class="token punctuation">.</span>androidCapacitorActivity<span class="token punctuation">.</span><span class="token function">unregisterBroadcastReceiver</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      isListening <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n\t\t<span class="token punctuation">}</span>\n\t<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n\t\t<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isListening<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t\t\tlistener <span class="token operator">=</span> NSNotificationCenter<span class="token punctuation">.</span>defaultCenter<span class="token punctuation">.</span><span class="token function">addObserverForNameObjectQueueUsingBlock</span><span class="token punctuation">(</span>\n\t\t\t\tNSProcessInfoPowerStateDidChangeNotification<span class="token punctuation">,</span>\n\t\t\t\t<span class="token keyword">null</span><span class="token punctuation">,</span>\n\t\t\t\t<span class="token keyword">null</span><span class="token punctuation">,</span>\n\t\t\t\t<span class="token punctuation">(</span>notif<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n\t\t\t\t\t<span class="token keyword">if</span> <span class="token punctuation">(</span>listenerCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t\t\t\t\t\t<span class="token function">listenerCallback</span><span class="token punctuation">(</span>NSProcessInfo<span class="token punctuation">.</span>processInfo<span class="token punctuation">.</span>lowPowerModeEnabled<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\t\t\t\t<span class="token punctuation">}</span>\n\t\t\t\t<span class="token punctuation">}</span>\n\t\t\t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\t\tisListening <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n\t\t<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n\t\t\tNSNotificationCenter<span class="token punctuation">.</span>defaultCenter<span class="token punctuation">.</span><span class="token function">removeObserver</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\t\tisListening <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n\t\t<span class="token punctuation">}</span>\n\t<span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\nnative<span class="token punctuation">.</span><span class="token function-variable function">isInLowPowerMode</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n\t<span class="token keyword">if</span> <span class="token punctuation">(</span>native<span class="token punctuation">.</span>android<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t\t<span class="token keyword">const</span> manager<span class="token operator">:</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>PowerManager <span class="token operator">=</span>\n\t\t\tnative<span class="token punctuation">.</span>androidCapacitorActivity\n\t\t\t  <span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context<span class="token punctuation">.</span><span class="token constant">POWER_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\t<span class="token keyword">if</span> <span class="token punctuation">(</span>manager<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\t\t\t<span class="token keyword">return</span> manager<span class="token punctuation">.</span><span class="token function">isPowerSaveMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\t\t<span class="token punctuation">}</span>\n\t<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n\t\t<span class="token keyword">return</span> NSProcessInfo<span class="token punctuation">.</span>processInfo<span class="token punctuation">.</span>lowPowerModeEnabled<span class="token punctuation">;</span>\n\t<span class="token punctuation">}</span>\n\t<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n</code></pre></div>',6);p.render=function(a,t,p,e,c,u){return n(),s("div",null,[o])};export default p;export{t as __pageData};
